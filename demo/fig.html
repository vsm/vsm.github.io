<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>

  <title>vsm-box demo with image export</title>

  <style>
    body { font-family: tahoma, verdana, arial, sans-serif;  margin: 0; }
    /* button { background-color: #eee; } */
    label, input { vertical-align: middle; }
    label { cursor: default; }
    label:hover, input[type='checkbox']:hover { box-shadow: 0 0 3px 0 rgba(0,0,0,0.1); }
    #main { padding: 5px 0 18px 50px;  background-color: #fff;  min-height: 180px; }
    #topPane { margin: 0 0 22px 0; padding: 5px; background-color: #f8f8f8;
      display: inline-block; font-size: 12px; }
    #exButtonsAndInfo { padding: 0 0 10px 0; }
    #info { float: right; margin: 4px 0 0 8px; }
    #info, #info a, #info a:visited, #infoChrome { font-size: 11px;  color: #aaa; }
    #info a:hover { color: #88f; }
    #dlButtons { padding: 0 0 5px 0; }
    #imgScale { width: 24px; margin: 0 0 0 3px; margin-bottom: 4px; }
    #msg { color: #aaa;  font-size: 11px; height: 12px;  margin: 90px 0 2px 0; text-align: right; }
    #stateText { outline: none;  font-size: 11px;  white-space: pre;  box-sizing: border-box;
      display: block;  border: 0.5px solid #b8b8b8; }

    /* To achieve pixel-precise alignment of vsmAC's TheList and the bottom of vsm-box
       on high-dpi screens: one could use a hard-coded _integer_ height for inputs:
    .vsm-box .term.inp input.input { height: 13px; }
       But then it cuts off lower part of 'g'-s a bit again, somehow, esp. in exported PNGs.
       So, we use this for now, optimized for Chrome and high-DPI screen with scaling factor 3: */
    .vsm-box .term.inp input.input { height: 14px; margin-top: -0.667px; }
    .vsm-box .term span.label { height: 16px; margin-top: -0.333px; }

    /* For font-awesome icons demo. */
    .vsm-box .item i.fas { margin-right: 3px; }
    .vsm-box .term.inp i.sep:before { content: "·"; margin: 0 4px 0 4px;
      font-style: normal; font-size: 8px; color: #777; }
    .vsm-box .term.inp i:before { color: #696969; }

    /* For showing `tweakID` (visible when 'useTweaks' are active). */
    .vsm-box .term.inp .item .item-part-extra        { font-size: 10px; color: #d2d2d2; }
    .vsm-box .term.inp .item.item-state-active .item-part-extra {       color: #ccc; }
    .vsm-box .term.inp .item .item-part-extra:before { font-size: 10px; content: "("; margin-left: 1.5px; }
    .vsm-box .term.inp .item .item-part-extra:after  { font-size: 10px; content: ")"; margin-right: 1px; }

    /* .vsm-box .term span.label { text-overflow: clip; }  /* Because FF puts ellipses in PNGs (with high-dpi screen) */

                      .vsm-box .term.inp .list { min-width: 160px; }  /* Make autocomplete-panel less wide than default */
    #vsmBox.useTweaks .vsm-box .term.inp .list { min-width: 140px; }  /* Even less wide */

    #vsmBox.useTweaks .vsm-box .term.inp .list { box-shadow: 0 1px 2px rgba(0, 0, 0, 0.23); }  /* Smaller autocomplete-panel shadow */

    #vsmBox.whiteBox .vsm-box svg.conns { background-color: #fff; }
    #vsmBox.whiteBox .vsm-box { border: 1px solid #fff; }
  </style>

  <!-- Include a vsm-dictionary, and a cacher for speed. -->
  <script src="https://unpkg.com/vsm-dictionary-local@^2.6.0/dist/vsm-dictionary-local.min.js"></script>
  <script src="https://unpkg.com/vsm-dictionary-cacher@^1.2.0/dist/vsm-dictionary-cacher.min.js"></script>

  <!-- No Vue etc libraries needed. These are bundled with 'vsm-box.standalone'. -->

  <!-- Include the 'standalone build' version of 'vsm-box'. -->
  <script src="https://unpkg.com/vsm-box@^1.0.0/dist/vsm-box.standalone.min.js"></script>

  <!-- Include a library for showing VSM JS-objects in a readable way, as JSON5. -->
  <script src="https://unpkg.com/vsm-json-pretty@^1.0.0/dist/vsm-json-pretty.min.js"></script>

  <!-- Include a library for converting JSON5 back to a JS-object. -->
  <script src="https://unpkg.com/json5@^2.1.0/dist/index.min.js"></script>

  <!-- For downloading the current vsm-box as an image. -->
  <script src="https://unpkg.com/dom-to-image-more/dist/dom-to-image-more.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
</head>


<body>

  <div id="main">
    <div id="topPane">
      <div id="exButtonsAndInfo">
        <span id="buttonsExamples"><!-- 'Example x' buttons are auto-inserted here. --></span>
        <span id="info">
          Info: <a href="https://vsmjs.github.io/">vsmjs.github.io</a>,&nbsp;
          <a href="https://github.com/vsmjs/vsm-box">vsm-box</a>,&nbsp;
          <a href="http://scicura.org/vsm/vsm.html">VSM</a>,&nbsp;
          <a href="http://scicura.org/vsm/examples.html">examples</a>.
        </span>
      </div>
      <div id="dlButtons">
        <button id="buttonGetPng">Download vsm-box PNG</button>
        <button id="buttonGetPngDelayed3">Or in 3 sec</button>
        <button id="buttonGetPngDelayed10">Or in 10 sec</button>
        &nbsp;Scale: <input id="imgScale"> &nbsp;
        <button id="buttonGetSvgDelayed3">Or SVG in 3 sec</button>
        &nbsp; <span id="infoChrome">(&larr; use Chrome for download)</span>
      </div>
      <div id="options">
        <div>
          <input id="toggleCreateItem" type="checkbox"
          ><label for="toggleCreateItem">Hide 'Create "term"' in autocomplete list.</label>&nbsp;
          <input id="toggleWhiteBox" type="checkbox"
          ><label for="toggleWhiteBox">White VsmBox.</label>&nbsp;
          <input id="toggleNoFeet" type="checkbox"
          ><label for="toggleNoFeet">Hide connector feet.</label>&nbsp;
          <span style="display: none;">
            <input id="toggleKeepSvgCursor" type="checkbox"
            ><label for="toggleKeepSvgCursor">Keep cursor in SVG.</label>&nbsp;
          </span>
          <input id="toggleUseTweaks" type="checkbox"
          ><label for="toggleUseTweaks">Use dict/etc tweaks.</label>&nbsp;
          <input id="toggleJSON5" type="checkbox"
          ><label for="toggleJSON5">JSON5.</label>&nbsp;
        </div>
      </div>
    </div>

    <div id="vsmBoxWrapper">
      <vsm-box id="vsmBox"></vsm-box>
    </div>

    <div id="msg"></div>
    <textarea id="stateText" rows="18" cols="80" spellcheck="false"></textarea>
  </div>


  <!-- Here one can override vsm-box & vsm-autocomplete's default CSS-styles --
  <style> .vsm-box .vsm-autocomplete .item-type-literal { color: #55a; }
  </style> <!-- -->


  <script>
  // (--- See also 'index-prod-slim.html' ---).

  var useTweaks = true;  // Note: to get narrowest possible vsmBox, when filling
                         // in a `vsmExamples[..]`, (i.e. with narrow endTerm):
                         // this must be set to `true` at start!
  var whiteBox = false;

  var minEndTermWideWidthTweak = 20; // 100;


  // Creates the vsm-dictionary. Called at start, and when toggling 'useTweaks'.
  function createDict() {
    var demoData = createData();
    var options = Object.assign(
      demoData,
      ///{ delay: [20, 350] }  // Realistic delay. VsmDict-Cacher speeds it up again.
    );
    return new (VsmDictionaryCacher(VsmDictionaryLocal)) (options);
  }


  var elVsmBox = document.getElementById('vsmBox');
  var elMsg = document.getElementById('msg');
  var elTxt = document.getElementById('stateText');

  var vsmBoxInitialValue = { terms: [], conns: [] };
  var vsmBoxInitialSizes = {
    minWidth:  100,  // Note: standalone vsm-box can never start narrower than
                     // 200 (it's default) because it initializes with its
                     // default width before we can update its sizes property.
    minEndTermWidth: 40,      // } = VsmBox's default. Needed because these may..
    minEndTermWideWidth: 100, // } ..be changed, and back.
    connFootVisible: true
  };

  var vsmBoxSizes;  // Current value of `sizes`-attribute set on vsmBox.
  var lastAutoFilledText = '';
  var currentValue = vsmBoxInitialValue;


  /* Set props and an event listener on the vsm-box webcomponent.
     + Note: 'vsm-box' is not inside a Vue-activated '#app'-element here,
       so we can not use `v-bind:...` to sync variables to it.
       To set props here, we must assign Strings and Objects to the element's
       attributes.  - Note that assigning e.g. a Boolean `true` would not work,
       so we'd need to use the String `'true'` */
  elVsmBox.vsmDictionary = createDict();
  elVsmBox.queryOptions = {};
  elVsmBox.autofocus    = 'true';
  elVsmBox.placeholder  = 'Type here'; ///'Type a term or doubleclick for menu';
  elVsmBox.cycleOnTab   = 'true';
  elVsmBox.initialValue = vsmBoxInitialValue;  // We must assign either Objects..
  elVsmBox.freshListDelay = '0';             // ..or Strings, to the attributes.
  updateVsmBoxSizes(vsmBoxInitialSizes);

  function updateVsmBoxSizes(sizes) {  // It detects change when given `new` Obj.
    elVsmBox.sizes = vsmBoxSizes = Object.assign({}, vsmBoxSizes, sizes);
  }


  elVsmBox.customItem = function(o) {
    if (useTweaks) {
      if (/^(VAR|BIO):/.test(o.item.id)) {
        o.strs.info = '';
      }
      if (o.item.z && o.item.z.tweakID) {
        o.strs.extra = '' + o.item.z.tweakID;
      }
    }
    return o.strs;
  };

  elVsmBox.addEventListener('change', onChange);


  // Initialize the checkbox for removing/adding the Create-Term item the autocomplete list.
  var el = document.getElementById('toggleCreateItem');
  elVsmBox.allowClassNull = 'true';
  el.checked = false;  // Setting this forces a reset of the checkbox at pageload.
  el.addEventListener('change', function(ev) {
    elVsmBox.allowClassNull = '' + !ev.target.checked;
  });


  // Init checkbox for making the TheConn's background and VsmBox's border both white.
  el = document.getElementById('toggleWhiteBox');
  el.checked = whiteBox;
  elVsmBox.classList[whiteBox ? 'add' : 'remove']('whiteBox');
  el.addEventListener('change', function() {
    whiteBox = !whiteBox;
    elVsmBox.classList.toggle('whiteBox');
  });


  // Init checkbox for removing connectors' feet.
  el = document.getElementById('toggleNoFeet');
  el.checked = false;
  el.addEventListener('change', function() {
    updateVsmBoxSizes({ connFootVisible: !vsmBoxSizes.connFootVisible });
  });


  // Init checkbox for activating some tweaks to the dictionaries, for VSM-paper figs.
  el = document.getElementById('toggleUseTweaks');
  el.checked = useTweaks;
  el.addEventListener('change', function() {
    useTweaks = !useTweaks;
    elVsmBox.vsmDictionary = createDict();
    elVsmBox.classList.toggle('useTweaks');
    widthToggle();
  });
  elVsmBox.classList[useTweaks ? 'add' : 'remove']('useTweaks');
  widthToggle();
  
  // Note: vsmBox currently does not reduce width (until page reload), so this
  // code only narrows a VsmBox, when `useTweaks==true` at start! <---
  function widthToggle() {
    updateVsmBoxSizes({
      minEndTermWidth:     useTweaks ?  1 : vsmBoxInitialSizes.minEndTermWidth,
      minEndTermWideWidth: useTweaks ? minEndTermWideWidthTweak:
                                            vsmBoxInitialSizes.minEndTermWideWidth
    });
  }


  // Init checkbox for keeping/removing a visible cursor in export of vsm-box to SVG.
  el = document.getElementById('toggleKeepSvgCursor');  // (Used for (earlier) vsmBoxToSvg code).
  var keepSvgCursor = false;
  el.checked = keepSvgCursor;
  el.addEventListener('change', function() { keepSvgCursor = !keepSvgCursor; });


  // Init checkbox for toggling JSON/JSON5 output in the stateText.
  el = document.getElementById('toggleJSON5');
  var json5 = true;
  el.checked = json5;
  el.addEventListener('change', function() {
    json5 = !json5;
    boxValueToStateText(currentValue);
  });


  // Initialize the input for the PNG scaling-value (png or any other bitmap format).
  var elImgScale = el = document.getElementById('imgScale');
  var scale = 5;
  el.value = scale;
  el.addEventListener('input', function() { scale = ~~elImgScale.value; });
  el.addEventListener('keypress', function (ev) {
    if (ev.key == 'Enter')  downloadVsmBox(elVsmBox, { scale });
  });
  

  // Initialize the 'stateText' textarea-element.
  var elTxtMaxCols = 115;
  elTxt.cols = elTxtMaxCols;
  // -- 1) TRANSFER INIT: Initial VsmBox ==> textarea.
  boxValueToStateText(vsmBoxInitialValue);

  // -- 2) TRANSFER IN: If textarea changes ==> change VsmBox.
  elTxt.addEventListener('input', stateTextToBoxValue);

  // Also disable Tab in the textarea, as it is a common code-editing key, and
  // would move the focus to the Clear button.
  elTxt.addEventListener('keydown', function(ev) {
    if (ev.key == 'Tab')  ev.preventDefault();
  });


  // Initialize the 'msg' element.
  elMsg.style.width = getComputedStyle(elTxt).width;
  setMsg('');



  // -- 3) TRANSFER OUT: VsmBox changes ==> change textarea.
  function onChange(event) {
    // Note: we must access `$emit()`'s args via `events.detail[]`. This is
    // different for a webpacked webcomponent vs. a pure Vue-component.
    boxValueToStateText(event.detail[0]);
  }


  function boxValueToStateText(value) {         // (See vsm-box's index-dev.js).
    currentValue = value;
    elTxt.value = lastAutoFilledText = 
      VsmJsonPretty(value, { json5: json5, maxLength: elTxtMaxCols });
    setMsg(1);
  }


  function stateTextToBoxValue() {              // (See vsm-box's index-dev.js).
    var abort = lastAutoFilledText === elTxt.value;
    lastAutoFilledText = false;
    if (abort)  return;

    try {
      elVsmBox.initialValue = currentValue = JSON5.parse(elTxt.value);
      setMsg(-1);
    }
    catch (err) {
      setMsg(err.toString().replace('JSON5: ', ''));
    }
  }


  function setMsg(msg) {
    var d = new Date();
    d = '[' + ('0' + d.getHours()).slice(-2) + ':' +
      ('0' + d.getMinutes()).slice(-2) + ':' +
      ('0' + d.getSeconds()).slice(-2) + '.' +
      ('00' + d.getMilliseconds()).slice(-3, -1) + ']';
    elMsg.innerHTML = !msg ? '' :
      ((msg == -1 ? '<---' : msg == 1 ? '--->' : msg) + ' &nbsp;' + d);
  }


  document.getElementById('buttonGetPng').onclick = function() {
    downloadVsmBox(elVsmBox, { scale });
  }


  document.getElementById('buttonGetPngDelayed3').onclick = function() {
    downloadVsmBox(elVsmBox, { scale, delay: 3e3 });
  }


  document.getElementById('buttonGetPngDelayed10').onclick = function() {
    downloadVsmBox(elVsmBox, { scale, delay: 10e3 });
  }


  document.getElementById('buttonGetSvgDelayed3').onclick = function() {
    downloadVsmBox(elVsmBox,
      { format: 'svg', scale, delay: 3e3, keepSvgCursor }
    );
  }


  /**
   * Generates image-data for the VsmBox at the given HTMLElement `elem`,
   * and offers it in a Save As dialog, for to the user to download.
   * + This requires the package 'dom-to-image-more'. Include it like this:
   *     <script src="https://unpkg.com/dom-to-image-more/dist/dom-to-image-more.min.js">< /script>
   * + `options` (optional, with all optional properties):
   *   - filename {String}:
   *       name without extension.
   *   - format {String}:
   *       supported formats are: 'png', 'svg',
   *       (and probably some more, see the package 'dom-to-image-more').
   *   - delay  {Number}:
   *       will generate and send the data after this amount
   *       of milliseconds. Useful when needing to clicking the download-button,
   *       and then still having some time to interact with the vsm-box
   *       (e.g. to highlight a conn, or to bring up the autocomplete panel).
   *   - keepSvgCursor {Boolean}:
   *       used when format is 'svg'; because it generates SVGs with
   *       a `foreignObject` node, which includes an <input>. Then when opening
   *       the SVG in a browser, that input gets focused, showing a text cursor.
   *       When `false`, a small modification is made to the SVG-code to hide it.
   *   - bgcolor {String}:
   *       argument given directly to 'dom-to-image-more':
   *       the background color used for the bitmap image.
   *   - scale {Number}:
   *       argument given directly to 'dom-to-image-more':
   *       the scaling factor used for the bitmap (e.g. png)  image.
   *       (This is supported by 'dom-to-image-more', unlike 'dom-to-image').
   */
  function downloadVsmBox(elem, options) {
    var DefaultOptions = {
      filename: 'vsm-box',
      format: 'png',
      delay: 0,
      keepSvgCursor: true,
      bgcolor: '#fff',
      scale: 1,
    };
    var opt = Object.assign({}, DefaultOptions, options);

    if (opt.delay > 0) {
      var delay = opt.delay;
      opt.delay = 0;
      return setTimeout(function () { downloadVsmBox(elem, opt); }, delay);
    }

    var ext = opt.format.toLowerCase();
    var toImg = domtoimage['to' + ext[0].toUpperCase() + ext.substr(1)];  // => e.g. `domtoimage.toPng`.
    if (!toImg) {
      return console.error('Error: unsupported output format: ' + opt.format, error);
    }

    var el = elem.querySelector('.vsm-box');
    var imgOpt = { bgcolor: opt.bgcolor, scale: opt.scale };

    toImg(el, imgOpt).then(function (dataUrl) {
      if (opt.format == 'svg'  &&  !opt.keepSvgCursor) {
        dataUrl = dataUrl
        .replace(/(cursor: text;.{1,100})inline-block;/g, '$1none;');
      }
      downloadUrl(dataUrl, opt.filename + '.' + ext);
    }).catch(function (error) {
      console.error('Error with dom-to-image-more', error);
    });

    function downloadUrl(url, filename) {
      var link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      delete link;
    }
  }


  // ---------- DEMO-VSM-SENTENCES ----------
  var vsmExamples = [
    // --- 0  // This one's button says 'Clear'.
    {
      terms: [],
      conns: []
    },

    // --- 1
    {
      terms: [
        { str: 'John',    classID: 'PRS:0010', instID: null },
        { str: 'eats',    classID: 'VAR:0101', instID: null },
        { str: 'chicken', classID: 'BIO:0042', instID: null,
          dictID: 'http://x.org/BIO',  descr: 'the animal',
          queryOptions: { sort: { dictID: ['http://x.org/BIO'] } } },
        { str: 'with',    classID: 'VAR:0105', instID: null,
          dictID: 'VAR',  descr: 'using' },
        { str: 'fork',    classID: 'VAR:0108', instID: null,
          queryOptions: { fixedTerms: [ { id: 'VAR:0107', str: 'spoon' } ] } }
      ],
      conns: [
        { type: 'T', pos: [0, 1, 2] },
        { type: 'T', pos: [1, 3, 4] }
      ]
    },
    
    // --- 2
    {
      terms: [
        { str: 'Alice', classID: 'PRS:0001', instID: null, dictID: 'PRSNS' },
        { str: 'reading', classID: null, instID: null },
        { str: 'letter', classID: null, instID: null },
        { str: 'from', classID: 'VAR:0025', instID: null, dictID: 'VAR' },
        { str: 'John', classID: 'PRS:0010', instID: null, dictID: 'PRSNS' },
        { str: 'eats', classID: 'VAR:0101', instID: null,  dictID: 'VAR', descr: 'to eat' },
        { str: 'potato', classID: null, instID: null },
        { str: 'tomato', classID: null, instID: null },
        { str: 'and', classID: 'VAR:0005', instID: null,  dictID: 'VAR', descr: 'a set of items' },
        { str: 'almost', classID: null, instID: null },
        { str: '2', classID: '00:2e+0', instID: null, dictID: '00' },
        { str: 'fish', classID: null, instID: null },
        { str: 'with', classID: 'VAR:0105', instID: null,  dictID: 'VAR', descr: 'using' },
        { str: 'blue', classID: null, instID: null },
        { str: 'fork', classID: 'VAR:0108', instID: null, dictID: 'VAR',
          descr: 'utensil<i class=\'sep\'></i><i class=\'fas fa-utensils\'></i>' }
      ],
      conns: [
        { type: 'T', pos: [ 2, 3, 4 ] },
        { type: 'T', pos: [ 0, 1, 2 ] },
        { type: 'T', pos: [ 10, -1, 9 ] },
        { type: 'T', pos: [ 11, -1, 10 ] },
        { type: 'L', pos: [ 8, 6, 7, 11 ] },
        { type: 'T', pos: [ 0, 5, 8 ] },
        { type: 'T', pos: [ 5, 12, 14 ] },
        { type: 'T', pos: [ 14, -1, 13 ] }
      ]
    },
    
    // --- 3
    {
      terms: [
        { str: 'John',          classID: 'http://ont.ex/John',          instID: 'http://db.ex/00' },
        { str: 'pushing',        classID: 'http://ont.ex/to-push',       instID: 'http://db.ex/01' },
        { str: 'button',        classID: 'http://ont.ex/button',        instID: 'http://db.ex/02' },
        { str: 'having color',  classID: 'http://ont.ex/to-have-color', instID: 'http://db.ex/03' },
        { str: 'green',         classID: 'http://ont.ex/green',         instID: 'http://db.ex/04' },
        { str: 'causes',       classID: 'http://ont.ex/to-cause',      instID: 'http://db.ex/05' },
        { str: 'it',            classID: 'http://ont.ex/button',        instID: 'http://db.ex/06', parentID: 'http://db.ex/02' },
        { str: 'to have color', classID: 'http://ont.ex/to-have-color', instID: 'http://db.ex/07' },
        { str: 'red',           classID: 'http://ont.ex/red',           instID: 'http://db.ex/08' },
        { str: 'and',           classID: 'http://ont.ex/and',           instID: 'http://db.ex/09' },
        { str: 'tiny',          classID: 'http://ont.ex/tiny',          instID: 'http://db.ex/10' },
        { str: 'bomb',          classID: 'http://ont.ex/bomb',          instID: 'http://db.ex/11' },
        { str: 'to explode',    classID: 'http://ont.ex/to-explode',    instID: 'http://db.ex/12' }
      ],
      conns: [
        { type: 'T', pos: [ 2, 3, 4 ] },
        { type: 'T', pos: [ 0, 1, 2 ] },
        { type: 'T', pos: [ 6, 7, 8 ] },
        { type: 'T', pos: [ 11, -1, 10 ] },
        { type: 'T', pos: [ 11, 12, -1 ] },
        { type: 'L', pos: [ 9, 7, 12 ] },
        { type: 'T', pos: [ 1, 5, 9 ] },
        { type: 'R', pos: [ 6, 2 ] }
      ]
    },
    
    // --- 4
    {
      terms: [
        { str: 'John',      classID: 'http://ont.ex/John',          instID: null },
        { str: 'saying',    classID: 'http://ont.ex/to-say',        instID: null },
        { str: 'duck',      classID: 'http://ont.ex/duck'                        },  // Class
        { str: 'has label', classID: 'http://ont.ex/to-have-label', instID: null },
        { str: 'canard'                                                          },  // Literal
        { str: 'implies',   classID: 'http://ont.ex/to-imply',      instID: null },
        { str: 'he',        classID: 'http://ont.ex/John',          instID: null, parentID: null },  // RefInstance
        { str: 'knows',     classID: 'http://ont.ex/to-know',       instID: null },
        { str: 'French',    classID: null,                          instID: null }   // =request to create new Class.
      ],
      conns: [
        { type: 'T', pos: [ 2, 3, 4 ] },
        { type: 'T', pos: [ 0, 1, 3 ] },
        { type: 'T', pos: [ 6, 7, 8 ] },
        { type: 'T', pos: [ 1, 5, 7 ] },
        { type: 'R', pos: [ 6, 0 ] }
      ]
    },
    
    // --- 5

    // --- 6
    {
      terms: [
        { str: 'UV', classID: null, instID: null },
        { str: 'induces', classID: null, instID: null },
        { str: 'NEDD4', classID: null, instID: null },
        { str: 'to ubiquitinate', classID: null, instID: null },
        { str: 'RNA polymerase II', classID: null, instID: null },
        { str: 'in', classID: 'to-be-located-in', instID: null },
        { str: 'nucleus', classID: null, instID: null },
        { str: 'negatively regulates', classID: null, instID: null },
        { str: 'it', classID: null, instID: null, parentID: null },
        { str: 'activating', classID: null, instID: null },
        { str: 'transcription', classID: null, instID: null }
      ],
      conns: [
        { type: 'T', pos: [ 2, 3, 4 ] },
        { type: 'T', pos: [ 3, 5, 6 ] },
        { type: 'T', pos: [ 0, 1, 3 ] },
        { type: 'T', pos: [ 8, 9, 10 ] },
        { type: 'T', pos: [ 3, 7, 9 ] },
        { type: 'R', pos: [ 8, 4 ] }
      ]
    },
    
    // --- 7
    {
      terms: [
        { str: 'UV', classID: null, instID: null },
        { str: 'causally upstream of',
          classID: 'http://purl.obolibrary.org/obo/RO_0002411',
          instID: null,
          dictID: 'http://data.bioontology.org/ontologies/OBOREL'
        },
        { str: 'NEDD4',
          //classID: 'UniProtKB:P46934',
          classID: 'https://www.uniprot.org/uniprot/P46934',
          instID: null,
          //dictID: 'http://golr-aux.geneontology.io'
          dictID: 'https://www.uniprot.org'
        },
        { str: 'ubiquitinating',
          classID: 'http://purl.obolibrary.org/obo/RO_0002480',
          instID: null,
          dictID: 'http://data.bioontology.org/ontologies/OBOREL'
        },
        { str: 'RNA polymerase II', classID: null, instID: null },
        { str: 'in', classID: 'to-be-located-in', instID: null },
        { str: 'nucleus', classID: null, instID: null },
        { str: 'negatively regulates',
          classID: 'http://purl.obolibrary.org/obo/RO_0002212',
          instID: null,
          dictID: 'http://data.bioontology.org/ontologies/OBOREL'
        },
        { str: 'it', classID: null, instID: null, parentID: null },
        { str: 'activating', classID: null, instID: null },
        { str: 'transcription', classID: null, instID: null }
      ],
      conns: [
        { type: 'T', pos: [ 2, 3, 4 ] },
        { type: 'T', pos: [ 3, 5, 6 ] },
        { type: 'T', pos: [ 0, 1, 3 ] },
        { type: 'T', pos: [ 8, 9, 10 ] },
        { type: 'T', pos: [ 3, 7, 9 ] },
        { type: 'R', pos: [ 8, 4 ] }
      ]
    },


    // --- Demo with all VSM-term types, as a test.
    {
      terms: [
        { str: 'John',      classID: 'PRS:0010', instID: 'db-id20',
          dictID: 'PRSNS',  descr: 'an example John',
          minWidth: 5, maxWidth: 80, editWidth: 50,
          queryOptions: {
            filter: { dictID: [ 'PRSNS', 'VAR' ] },
            sort: { dictID: [ 'VAR' ] },
            fixedTerms: [
              { id: 'PRS:0001', str: 'Alice' }, { id: 'BIO:0010' }  ] }
        },
        { str: 'activates', classID: 'BIO:0014', instID: null,
          isFocal: true },
        { str: 'spicy',     classID: 'VAR:0215', instID: null },
        { str: 'chicken',   classID: 'BIO:0042', instID: null,
          dictID: 'http://x.org/BIO',  descr: 'the animal',
          queryOptions: { sort: { dictID: ['http://x.org/BIO'] } } },
        { str: 'with',      classID: 'VAR:0105', instID: null,
          dictID: 'VAR',  descr: 'using' },
        { str: 'Ca2+', style: 'u2-4', descr: 'Calcium ion',
          classID: 'BIO:0010', instID: null },  ///, minWidth: 47},
        { str: 'with',      classID: 'VAR:0106', instID: null,
          dictID: 'VAR',  descr: 'accompanied by' },
        { str: 'cls', classID: 'A:01', dictID: 'A', descr: 'descr-1' },
        { str: 'lit' },
        { editWidth: 20, placeholder: 'pl' },
        { type: 'EC', editWidth: 20 },
        { type: 'EL', editWidth: 20 },
        { str: 'and',       classID: 'VAR:0005', instID: null,
          dictID: 'VAR',  descr: 'a set of items' },
        { str: 'himself',   classID: 'PRS:0010', instID: 'db-id40',
          parentID: 'db-id20'}
      ],
      conns: [
        { type: 'T', pos: [ 3, -1, 2 ] },
        { type: 'T', pos: [ 0, 1, 3 ] },
        { type: 'T', pos: [ 1, 4, 5 ] },
        { type: 'L', pos: [ 12, 7, 8, 9, 10, 11, 13 ] },
        { type: 'T', pos: [ 1, 6, 12 ] },
        { type: 'R', pos: [ 13, 0 ] }
      ]
    },
  ];
  ///vsmExamples.pop();  // Remove the last test-example.


  var buttonsExamples = document.getElementById('buttonsExamples');
  for (var i = 0; i < vsmExamples.length; i++) {
    var button = document.createElement('button');
    button.innerHTML = i == 0 ? 'Clear' : ((i == 1 ? 'Example ' : 'Ex') + i);
    button.id = 'buttonExample_' + i;
    buttonsExamples.appendChild(button);
    button.onclick = function() {
      var nr = this.id.split('_')[1];
      fillExample(nr);
    }
    buttonsExamples.appendChild(document.createTextNode(' '));
  }


  // Fills an example into the VsmBox, and also the textarea; and shows a msg.
  function fillExample(nr) {
    var data = vsmExamples[nr];
    elVsmBox.initialValue = JSON.parse(JSON.stringify(data));  // Clone=>new Obj.
    boxValueToStateText(data);
    setMsg(nr == 0 ? 'Cleared' : ('Example ' + nr));
  }



  // ---------- DEMO-DICTIONARY-DATA ----------
  function createData() {
    return {
      dictData: [
        { id: 'VAR',  abbrev: 'Varia',  name: 'Various English words',  entries: [
          { id: 'VAR:0045', terms: [{str: 'about'}] },
          { id: 'VAR:0082', terms: [{str: 'after'}] },
          { id: 'VAR:0036', terms: [{str: 'all'}] },
          { id: 'VAR:0080', terms: [{str: 'also'}] },
          { id: 'VAR:0095', terms: [{str: 'any'}] },
          { id: 'VAR:0017', terms: [{str: 'as'}] },
          //{ id: 'VAR:0081', terms: [{str: 'back'}] },
          //{ id: 'VAR:0094', terms: [{str: 'because'}] },
          { id: 'VAR:0024', terms: [{str: 'by'}] },
          //{ id: 'VAR:0053', terms: [{str: 'can'}] },
          //{ id: 'VAR:0076', terms: [{str: 'come'}] },
          //{ id: 'VAR:0067', terms: [{str: 'could'}] },
          { id: 'VAR:0098', terms: [{str: 'day'}] },
          { id: 'VAR:0019', terms: [{str: 'do'}] },
          //{ id: 'VAR:0088', terms: [{str: 'first'}] },
          { id: 'VAR:0025', terms: [{str: 'from'}] },
          { id: 'VAR:0047', terms: [{str: 'get'}] },
          { id: 'VAR:0097', terms: [{str: 'give'}] },
          { id: 'VAR:0049', terms: [{str: 'go'}] },
          { id: 'VAR:0065', terms: [{str: 'good'}] },
          { id: 'VAR:0009', terms: [{str: 'have'}] },
          { id: 'VAR:0062', terms: [{str: 'into'}] },
          //{ id: 'VAR:0057', terms: [{str: 'just'}] },
          { id: 'VAR:0059', terms: [{str: 'know'}] },
          { id: 'VAR:0054', terms: [{str: 'like'}] },
          { id: 'VAR:0074', terms: [{str: 'look'}] },
          { id: 'VAR:0052', terms: [{str: 'make'}] },
          { id: 'VAR:0099', terms: [{str: 'most'}] },
          { id: 'VAR:0092', terms: [{str: 'new'}] },
          { id: 'VAR:0056', terms: [{str: 'no'}] },
          { id: 'VAR:0013', terms: [{str: 'not'}] },
          { id: 'VAR:0073', terms: [{str: 'now'}] },
          { id: 'VAR:0014', terms: [{str: 'on'}] },
          { id: 'VAR:0035', terms: [{str: 'one'}] },
          { id: 'VAR:0075', terms: [{str: 'only'}] },
          { id: 'VAR:0031', terms: [{str: 'or'}] },
          { id: 'VAR:0078', terms: [{str: 'over'}] },
          { id: 'VAR:0061', terms: [{str: 'person'}] },
          { id: 'VAR:0066', terms: [{str: 'some'}] },
          { id: 'VAR:0060', terms: [{str: 'take'}] },
          { id: 'VAR:0079', terms: [{str: 'think'}] },
          { id: 'VAR:0055', terms: [{str: 'time'}] },
          { id: 'VAR:0084', terms: [{str: 'two'}] },
          { id: 'VAR:0042', terms: [{str: 'up'}] },
          //{ id: 'VAR:0093', terms: [{str: 'want'}] },
          //{ id: 'VAR:0090', terms: [{str: 'way'}] },
          { id: 'VAR:0087', terms: [{str: 'work'}] },
          //{ id: 'VAR:0063', terms: [{str: 'year'}, {str: 'years'}] },
          { id: 'VAR:0063', terms: [{str: 'year'}] },
          { id: 'VAR:0101', descr: 'to eat',
            terms: [{str: 'eat'}, {str: 'eats'}, {str: 'eating'}] },
          { id: 'VAR:0069',  descr: 'to see',
            terms: [{str: 'see'}, {str: 'sees'}, {str: 'to see'}] },
          { id: 'VAR:0028',  descr: 'to say',
            terms: [{str: 'say'}, {str: 'says'}, {str: 'to say'}] },
          { id: 'VAR:0107', terms: [{str: 'spoon'}], descr: 'utensil<i class="sep"></i><i class="fas fa-utensils"></i>' },
          { id: 'VAR:0207', terms: [{str: 'spoon'}], descr: 'to cuddle like two spoons<i class="sep"></i><i class="fas fa-heart"></i>' },
          { id: 'VAR:0108', terms: [{str: 'fork' }], descr: 'utensil<i class="sep"></i><i class="fas fa-utensils"></i>' },
          { id: 'VAR:0208', terms: [{str: 'fork' }], descr: 'GitHub<i class="sep"></i><i class="fas fa-code-branch"></i>' },
          { id: 'VAR:0109', terms: [{str: 'knife'}], descr: 'utensil<i class="sep"></i><i class="fas fa-utensils"></i>' },
          { id: 'VAR:0214', terms: [{str: 'burnt'}] },
          { id: 'VAR:0215', terms: [{str: 'spicy'}] },
          { id: 'VAR:0105', descr: 'to use', z: { tweakID: 'EN:0710' },
            terms: [
              { str: 'with', descr: useTweaks ? '= using' : 'using' },
              //{ str: 'to use' },
              { str: 'use' },
              { str: 'uses' },
              { str: 'using' },
              { str: 'use of' },
            ]
          },
          { id: 'VAR:0106', descr: 'to be accompanied by', z: { tweakID: 'EN:1105' },
            terms: [
              { str: 'with', descr: useTweaks ? '= accompanied by' : 'accompanied by' },
              { str: 'accompanied by' },
              { str: 'is accompanied by' }
            ]
          },
          { id: 'VAR:0020', descr: 'associated with', terms: [{str: 'at'}] },
          { id: 'VAR:0007', descr: 'to be located in', terms: [
            {str: 'in', style: ''}, {str: 'is located in'}, {str: 'located in'},
            {str: 'located at'}, {str: 'at'} ]
            ///, {str: 'locatedness-inside', style: 'i'}
          },
          { id: 'VAR:0115', descr: 'to happen in time period',
            terms: [{str: 'in'}, {str: 'during'}] },
          { id: 'VAR:0116', descr: 'to happen at timepoint',
            terms: [{str: 'at', descr: 'happens at timepoint'}] },
          { id: 'VAR:0111', descr: 'to pertain to',
            terms: [{str: 'in', descr: 'pertains to'}] },
          { id: 'VAR:0005', descr: 'a set of items',
            terms: [{str: 'and'}]
          },
          { id: 'VAR:0112', descr: 'a list where item order is important',
            terms: [{str: 'ordered-and', style: 'i0-8'}] },
          { id: 'VAR:0002', descr: 'to be',
            terms: [
              {str: 'to be'},
              {str: 'being'},
              {str: 'is', descr: 'to be, in 3rd-person form'},
              {str: 'are', descr: 'to be, in plural form'}
            ]
          },
          { id: 'VAR:0123', descr: 'belonging to', terms: [{str: 'of'}, {str: '\'s'}] },
          //{ id: 'VAR:0003', descr: 'having purpose', terms: [{str: 'to'}, {str: 'for'}] },
          { id: 'VAR:0126', terms: [{str: 'book'}] },
          //{ id: 'VAR:0131',
          //  descr: 'Single-term relation concept, for the \'if ... then ...\' ' +
          //    'construct used in natural language',
          //  terms: [{str: 'if-then'}]
          //},
          //{ id: 'VAR:0132',
          //  descr: '= \'if not {subject} then {object}\'',
          //  terms: [{str: 'else'}]
          //},
          { id: 'VAR:0133', terms: [{str: 'has'}] },
          //{ id: 'VAR:0141', descr: 'being located amongst',
          //  terms: [{str: 'between'}, {str: 'is between'}, {str: 'are between'}] },
          { id: 'VAR:0141', descr: 'being located amongst', terms: [{str: 'between'}] },
          //{ id: 'VAR:0142', descr: 'the location amongst some things',
          //  terms: [{str: 'between'}]
          //},
          { id: 'VAR:2001', terms: [{ str: 'blue' }] },

          { id: 'VAR:5103', descr: 'someone with little courage', z: { tweakID: 'EN:1510' },
            terms: [
              { str: 'coward' },
              { str: 'chicken', style: useTweaks ? 'i' : 'i',
                descr: useTweaks ? 'fearful person' : '\'coward\'' }
            ]
          },
          { id: 'VAR:5015', descr: 'Computer science, Information Technology',
            terms: [{str: 'IT'}] },
          { id: 'VAR:5016', descr: 'to turn on a device',
            terms: [
              ///{ str: 'activate' },
              { str: 'activates' }
            ],
            z: { extraChar: '⍾' }
          },
          { id: 'VAR:5017', terms: [{str: 'device'}] },
          //{ id: 'VAR:5018', descr: 'is subclass of',
          //  terms: [{str: 'is subclass of'}, {str: 'is a'}] },
          { id: 'VAR:5021', descr: 'percent',
            terms: [{str: 'percent'}, {str: '%'}, {str: 'percentage'}] },
          { id: 'VAR:5093', descr: 'unit of acceleration',
            terms: [{str: 'm/s2', style: 'u3'}] },
          //{ id: 'VAR:5151', descr: 'the mathematical operator \'for all\'',
          //  terms: [{str: '∀'}, {str: 'for all'}] },
          //{ id: 'VAR:5153', descr: 'the mathematical operator \'there exists\'',
          //  terms: [{str: '∃'}, {str: 'exists'}] },
          //{ id: 'VAR:5011',
          //  terms: [
          //    {str: 'HCO3- ⇌ CO32- + H+', style: 's3;u4;s10;u11-13;u17'}
          //  ],
          //  descr: 'step 2 of carbonic acid ionization reaction'
          //},
          { id: 'VAR:0256',
            descr: 'Visual Syntax Method, a way to represent ' +
              'contextualised information, so it is manageable by ' +
              'both humans and computers',
            terms: [{str: 'VSM'}]
          },
        ]},

        { id: 'PRSNS', abbrev: 'Persons', name: 'Person Names', entries: [
          { id: 'PRS:0001', terms: [{str: 'Alice'}] },
          { id: 'PRS:0002', terms: [{str: 'Bob'}] },
          { id: 'PRS:0003', terms: [{str: 'Clara'}] },
          { id: 'PRS:0004', terms: [{str: 'David'}] },
          { id: 'PRS:0005', terms: [{str: 'Eve'}] },
          //{ id: 'PRS:0006', terms: [{str: 'Frank'}] },
          { id: 'PRS:0007', terms: [{str: 'Greta'}] },
          { id: 'PRS:0008', terms: [{str: 'Heidi'}] },
          { id: 'PRS:0010', terms: [{str: 'John'}],
            descr: useTweaks ? '' : 'example John', z: { tweakID: 'ID:0912' } },
          { id: 'PRS:0009', terms: [{str: useTweaks ? 'Jos' : 'Jane'}], z: { tweakID: 'ID:1005' }
          },
          //{ id: 'PRS:0011', terms: [{str: 'Joy'}], descr: 'Dr.' },
          { id: 'PRS:0011', terms: [{str: useTweaks ? 'Joy' : 'Joy'}], z: { tweakID: 'ID:2209' }
          },
          { id: 'PRS:0012', terms: [{str: 'Robert'}] },
          { id: 'PRS:0013', terms: [{str: 'Robin'}] },
          { id: 'PRS:0014', terms: [{str: 'Taylor'}] },
          { id: 'PRS:0015', terms: [{str: 'Tom'}] },
          //{ id: 'PRS:0016', terms: [{str: 'Wally'}] },
          //{ id: 'PRS:0017', terms: [{str: 'Walter'}] },
          { id: 'PRS:0018', terms: [{str: 'Will'}] },
          //{ id: 'PRS:0019', terms: [{str: 'William'}] },
          //{ id: 'PRS:0020', terms: [{str: 'Wilson'}] },
          { id: 'PRS:0021', descr: 'Steven Vercruysse, creator of VSM',
            terms: [{str: 'Steven'}] },
        ]
        .map(o => {
          //if (!useTweaks) { o.descr = o.descr || ('example ' + o.terms[0].str) }
          return o;
        })},

        { id: 'http://x.org/BIO', abbrev: 'Biology', name: 'Biological concepts', entries: [
          { id:'BIO:0010', terms: [{str: 'Ca2+', style: 'u2-4'}] },
          { id:'BIO:0011', terms: [{str: 'Na+Cl-', style: 'u2;u5'}], descr: 'dissolved salt' },
          { id:'BIO:0001', terms: [{str: 'beta-Carotene'}, {str: 'β-Carotene'}] },
          { id:'BIO:0002', descr: 'the Human gene ICER', terms: [{str: 'ICER'}] },
          //{ id:'BIO:0003', descr: 'the Human gene cdc2',
          //  terms: [{str: 'cdc2', style: 'i'}],  ///, {str: 'cdc'}, {str: 'KRP5'},
          //  z: {species: 'Human'}
          //},
          //{ id:'BIO:0903', descr: 'the Mouse gene cdc2', terms: [{str: 'cdc2'}] },
          { id:'BIO:0014',
            descr: 'to activate a biomolecule',
            terms: [
              {str: 'activates'},
              //{str: 'activation'},
              {str: 'activation of', style: 'i10-13'}
            ],
          },
          { id:'BIO:0015', terms: [{str: 'inhibits'}] },
          { id:'BIO:0016', terms: [{str: 'regulates'}, {str: 'regulation'}] },
          { id:'BIO:0017', terms: [{str: 'has function'}] },
          { id:'BIO:0018', terms: [{str: 'according to'}] },
          { id:'BIO:0019', terms: [
            {str: 'binds to'},
            {str: 'binds'},
            {str: 'bind'},
            {str: 'bound to'}
          ]},
          { id:'BIO:0030',
            descr: 'addition of a ubiquitin-molecule tag to a protein, ' +
              'which marks it for degradation by a proteasome',
            terms: [{str: 'ubiquitinates'}]
          },
          { id:'BIO:0042',
            descr: useTweaks ? 'the animal' : 'animal', z: { tweakID: 'BIO:0309' },
            terms: [{str: 'chicken'}] },
          { id:'BIO:0101', descr: 'example molecule A', terms: [{str: 'A'}] },
          { id:'BIO:0102', descr: 'example molecule B', terms: [{str: 'B'}] },
          //{ id:'BIO:0103', descr: 'example molecule C', terms: [{str: 'C'}] },
          { id:'BIO:0104', descr: 'example molecule D', terms: [{str: 'D'}] },
          { id:'BIO:0124', descr: 'example molecule X', terms: [{str: 'X'}] },
          { id:'BIO:0131', descr: 'example protein A',  terms: [{str: 'protein A'}] },
          { id:'BIO:0132', descr: 'example protein B',  terms: [{str: 'protein B'}] },
          { id:'BIO:0133', descr: 'example location C', terms: [{str: 'location C'}] },
          //{ id:'BIO:0151', descr: 'the blade of a plant leaf (Plant Ontology term)',
          //  terms: [{str: 'leaf lamina'}] },
          //{ id:'BIO:0152', descr: 'a plant leaf shape variation (PATO term)',
          //  terms: [{str: 'twisted'}] },
        ]},

        // These come in addition to vsm-dictionary's auto-generated numbers:
        { id: '00', abbrev: 'Numbers', name: 'Numbers', entries: [
          //{ id: '00:5e+0',   terms: [{str:  '5'}, {str: 'five'}] },
          { id: '00:1.2e+1', terms: [{str: '12'}, {str: 'twelve'}, {str: 'dozen'}],
            descr: 'the amount of twelve' },
          //{ id: '00:4e+1',   terms: [{str: '40'}, {str: 'forty'}] },
        ]},

        { id: 'NEW', abbrev: 'New', name: 'New Concepts', entries: [] },
      ],

      refTerms: [
        'it', 'this', 'that', 'they', 'these', 'them'
      ]
    };
  }

  </script>

</body>
</html>